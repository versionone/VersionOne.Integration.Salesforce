<!-- Page -->
<apex:page controller="SettingsController" action="{!initSettings}" title="VersionOne Integration Settings">
    <script>
        function disableAllButtons() {
            disableSaveButtons();
            disableTestButtons();
        }
        function disableSaveButtons() {
            disableSaveButton1();
            disableSaveButton2();
        }
        function disableTestButtons() {
            disableTestButton1();
            disableTestButton2();
        }
    </script>
    <apex:sectionHeader title="Settings for VersionOne integration." />

    <apex:actionStatus startText="Testing settings..." id="test_status" />
    <apex:actionStatus startText="Saving settings..." id="save_status" />
    <apex:actionStatus startText="Syncronization in progress..." id="sync_status" />

    <apex:form >
        <apex:pageBlock title="Settings" mode="edit">
            <apex:pageBlockSection title="VersionOne settings" columns="1">
                <!-- title="Connection" -->
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="{!settings.pathTitle}" for="V1Path" />
                    <c:inputRequiredText value="{!settings.path}" size="75" id="V1Path"
                        tabindex="1" onkeydown="disableSaveButtons()" onchange="disableSaveButtons()" maxlength="255"/>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="{!settings.UserNameTitle}" for="UserName" />
                    <c:inputRequiredText value="{!settings.UserName}" size="40"
                        id="UserName" tabindex="2"
                        onkeydown="disableSaveButtons()" onchange="disableSaveButtons()" maxlength="20"/>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="{!settings.PasswordTitle}" for="Password" />
                    <apex:outputPanel styleClass="requiredInput" layout="block">
                        <apex:outputPanel styleClass="requiredBlock" layout="block"/>
                        <apex:inputSecret value="{!settings.Password}" size="40" redisplay="true"
                            id="Password" tabindex="3" onkeydown="disableSaveButtons()" onchange="disableSaveButtons()" maxlength="20"/>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="{!settings.SourceTitle}" for="Source" />
                    <c:inputRequiredText value="{!settings.Source}" size="40"
                        id="Source" tabindex="4"
                        onkeydown="disableSaveButtons()" onchange="disableSaveButtons()" maxlength="30"/>
                </apex:pageBlockSectionItem>
            </apex:pageBlockSection>

            <apex:pageBlockSection title="Case publishing">
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="{!settings.DefectQueueIdTitle}" for="DefectQueue"/>
                    <apex:outputPanel styleClass="requiredInput" layout="block">
                        <apex:outputPanel styleClass="requiredBlock" layout="block"/>
                        <apex:selectList value="{!settings.DefectQueueId}" size="1" required="false" id="DefectQueue">
                            <apex:selectOptions value="{!QueueList}"/>
                        </apex:selectList>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="{!settings.DestQueueIdTitle}" for="DestQueue"/>
                    <apex:outputPanel styleClass="requiredInput" layout="block">
                        <apex:outputPanel styleClass="requiredBlock" layout="block"/>
                        <apex:selectList value="{!settings.DestQueueId}" size="1" required="false" id="DestQueue">
                            <apex:selectOptions value="{!QueueList}"/>
                        </apex:selectList>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="{!settings.StoryQueueIdTitle}" for="StoryQueue"/>
                    <apex:outputPanel styleClass="requiredInput" layout="block">
                        <apex:outputPanel styleClass="requiredBlock" layout="block"/>
                        <apex:selectList value="{!settings.StoryQueueId}" size="1" required="false" id="StoryQueue">
                            <apex:selectOptions value="{!QueueList}"/>
                        </apex:selectList>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>
            </apex:pageBlockSection>

            <apex:pageBlockSection columns="1">
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="{!settings.CommentBodyTitle}" for="Comment"/>
                    <apex:inputTextarea value="{!settings.CommentBody}" id="Comment" cols="75" rows="6"/>
                </apex:pageBlockSectionItem>
            </apex:pageBlockSection>

            <apex:pageBlockSection title="Case synchronization"  columns="1">
                <apex:pageBlockSectionItem >
                    <apex:outputLabel for="forceSync"/>
                    <apex:commandButton action="{!forceSync}" value="Force Synchronization" id="forceSync"
                        status="sync_status" reRender="messages, out_saving, out_testing" styleClass="btnImportant"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Schedule synchronization" for="EnableSync"/>
                    <apex:inputCheckbox value="{!isSyncEnabled}" id="EnableSync"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="{!settings.CommentOnClosingTitle}" for="CommentOnClosing"/>
                    <apex:inputTextarea value="{!settings.CommentOnClosing}" id="CommentOnClosing" cols="75" rows="6"/>
                </apex:pageBlockSectionItem>
            </apex:pageBlockSection>

            <apex:pageBlockButtons location="top">
                <apex:commandButton value="Save settings" action="{!saveSettings}"
                    disabled="{!isSettingsCorrect == false}" id="save_button1"
                    onclick="disableAllButtons()" status="save_status"
                    rerender="out_testing, out_saving, message_test, message_save, save_button1, save_button2, test_button1, test_button2, messages">
                    <script type="text/javascript">
                        function disableSaveButton1() {
                        var ele = document.getElementById('{!$Component.save_button1}');
                        ele.disabled = true;
                        ele.className = 'btnDisabled';
                    }
                </script>
                </apex:commandButton>
                <apex:commandButton value="Test settings" action="{!testSettings}"
                    rerender="out_testing, out_saving, message_test, messge_save, save_button1, save_button2, test_button1, test_button2, messages"
                    onclick="disableAllButtons()"
                    status="test_status" id="test_button1">
                    <script type="text/javascript">
                        function disableTestButton1() {
                            var ele = document.getElementById('{!$Component.test_button1}');
                            ele.disabled = true;
                            ele.className = 'btnDisabled';
                        }
                </script>
                </apex:commandButton>
            </apex:pageBlockButtons>
            <apex:pageBlockButtons location="bottom">
                <apex:commandButton value="Save settings" action="{!saveSettings}"
                    disabled="{!isSettingsCorrect == false}" id="save_button2"
                    onclick="disableAllButtons()" status="save_status"
                    rerender="out_testing, out_saving, message_test, message_save, save_button1, save_button2, test_button1, test_button2, messages">
                    <script type="text/javascript">
                    function disableSaveButton2() {
                        var ele = document.getElementById('{!$Component.save_button2}');
                        ele.disabled = true;
                        ele.className = 'btnDisabled';
                    }
                </script>
                </apex:commandButton>
                <apex:commandButton value="Test settings" action="{!testSettings}"
                    rerender="out_testing, out_saving, message_test, message_save, save_button1, save_button2, test_button1, test_button2, messages"
                    onclick="disableAllButtons()"
                    status="test_status" id="test_button2">
                    <script type="text/javascript">
                        function disableTestButton2() {
                        var ele = document.getElementById('{!$Component.test_button2}');
                        ele.disabled = true;
                        ele.className = 'btnDisabled';
                    }
                </script>
                </apex:commandButton>
            </apex:pageBlockButtons>
        </apex:pageBlock>
    </apex:form>

    <apex:outputPanel id="out_testing">
        <apex:pageMessage severity="{!testSeverity}" id="message_test"
            title="Testing result" summary="{!testMessage}"
            rendered="{!isSettingsValidated}" strength="1" />
    </apex:outputPanel>

    <apex:outputPanel id="out_saving">
        <apex:pageMessage severity="{!saveSeverity}" id="message_save"
            title="Saving result" summary="{!saveMessage}" rendered="{!isSaved}"
            strength="1" />
    </apex:outputPanel>

    <apex:pageMessages id="messages" />
</apex:page>